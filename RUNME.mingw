#!/bin/sh
# 
# Copyright (C) 2014 Neil McGill
#
# This game is free software; you can redistribute it and/or
# modify it under the terms of the GNU Library General Public
# License as published by the Free Software Foundation; either
# version 2 of the License, or (at your option) any later version.
#
# This game is distributed in the hope that it will be fun,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Library General Public License for more details.
#
# You should have received a copy of the GNU Library General Public
# License along with this game; if not, write to the Free
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#

TOP_DIR=`pwd`
TP_DIR=third-party

. ./scripts/common.sh

cat <<%%

     .d8888b.                                     888 d8b          888      
    d88P  Y88b                                    888 Y8P          888      
    888    888                                    888              888      
    888         .d88b.  888d888 888  888 88888b.  888 888  .d8888b 88888b.  
    888  88888 d88""88b 888P"   888  888 888 "88b 888 888 d88P"    888 "88b 
    888    888 888  888 888     888  888 888  888 888 888 888      888  888 
    Y88b  d88P Y88..88P 888     Y88b 888 888  888 888 888 Y88b.    888  888 
     "Y8888P88  "Y88P"  888      "Y88888 888  888 888 888  "Y8888P 888  888 
                                     888                                    
                                Y8b d88P                                    
                                 "Y88P"                                     

On MingW!

%%

log_info "Will try to install the third party stuff I need first for MinGW"

for i in \
	/c/MingW \
	/cygdrive/c/MinGW \
	/MinGW
do
	if [ -d "$i" ]
	then
		MINGW_DIR=$i
		break
	fi
done

if [ $MINGW_DIR = "" ]
then
	log_err "Could not find MingW dir"
	exit 1
fi

log_info "MinGW install dir $MINGW_DIR"
 
if [ ! -d $TP_DIR ]
then
	log_err "Could not find third party dir"
	exit 1
fi

mycp()
{
	local a=$1
	local b=$2

	for i in $a 
	do
		run cp -rpvf $i $b

		if [ $? -ne 0 ]
		then
			log_err "Failed to copy $i to $MINGW_DIR"
			exit 1
		fi
	done
}

#
# Extract tar files
#
(
	pushd $TP_DIR >/dev/null

	for i in *.tar.gz
	do
		run tar xf $i
	done

	popd >/dev/null
)

mkdir /c/MingW/include/SDL2

#mycp "third-party/SDL-2.0.4-9174/include/*" $MINGW_DIR/include/SDL2/
#mycp "third-party/SDL-2.0.4-9174/sdl2-config" $MINGW_DIR/bin
#mycp "third-party/SDL-2.0.4-9174/build/.libs/*.a" $MINGW_DIR/lib
#mycp "third-party/SDL-2.0.4-9174/build/.libs/*.dll" $MINGW_DIR/bin
#mycp "third-party/SDL-2.0.4-9174/build/.libs/*.dll" $TOP_DIR

mycp "third-party/SDL-2.0.4-9799/include/*" $MINGW_DIR/include/SDL2/
mycp "third-party/SDL-2.0.4-9799/sdl2-config" $MINGW_DIR/bin
mycp "third-party/SDL-2.0.4-9799/build/.libs/*.a" $MINGW_DIR/lib
mycp "third-party/SDL-2.0.4-9799/build/.libs/*.dll" $MINGW_DIR/bin
mycp "third-party/SDL-2.0.4-9799/build/.libs/*.dll" $TOP_DIR

mycp "third-party/SDL2_net-2.0.0/*.h" $MINGW_DIR/include/SDL2/
mycp "third-party/SDL2_net-2.0.0/.libs/*.a" $MINGW_DIR/lib/
mycp "third-party/SDL2_net-2.0.0/.libs/*.dll" $MINGW_DIR/bin/
mycp "third-party/SDL2_net-2.0.0/.libs/*.dll" $TOP_DIR

mycp "third-party/SDL2_mixer-2.0.0/*.h" $MINGW_DIR/include/SDL2/
mycp "third-party/SDL2_mixer-2.0.0/build/.libs/*.a" $MINGW_DIR/lib
mycp "third-party/SDL2_mixer-2.0.0/build/.libs/*.dll" $MINGW_DIR/bin
mycp "third-party/SDL2_mixer-2.0.0/build/.libs/*.dll" $TOP_DIR

mycp "third-party/SDL2_mixer-2.0.0/i686-w64-mingw32/bin/*.dll" $MINGW_DIR/bin
mycp "third-party/SDL2_mixer-2.0.0/i686-w64-mingw32/bin/*.dll" $TOP_DIR

mycp "third-party/makedepend-1.0.5/*.exe" $MINGW_DIR/bin/
mycp "third-party/makedepend-1.0.5/*.exe" $TOP_DIR

cd $TOP_DIR

./RUNME

if [ $? -eq 0 ]
then
    cd windows
    ./windows.sh
fi
